# TODO / Planned Work

This file collects planned features, ideas, and technical cleanups that were previously scattered in `VERSIONS.md` and `todo.txt`.

## Gameplay / Features

- [x] Bridge/ford generation across rivers
- [x] Named towns and persistent inventories/NPCs across visits
- [x] Shop UI (buy/sell) and currency
- [ ] District themes (market / residential / temple) and signage
- [ ] Movement costs or effects per biome (swamp slow, snow visibility, desert hazard)
- [ ] World generation: support larger lakes and inland water bodies
  - Allow the overworld generator to create bigger lakes and inland seas, not just thin rivers or small ponds.
  - Ensure lake size integrates with biome transitions (e.g., beaches, marshy shorelines) and walkability rules.
  - Consider special POIs or encounters attached to large lakes (ferries, fishing huts, ruined piers) in future work.
- [ ] If there are not enough beds at home for an NPC, let them sleep on the floor
- [ ] Move flavor text into JSON data (data-driven flavor)
- [ ] Port towns/cities with distinct layouts
  - Add special “port” variants of towns/cities that sit on coasts, rivers, or lakes.
  - Layout differences from normal towns:
    - Partially walled (open toward the water, or with lighter defenses on the harbor side).
    - Visible water edge integrated into town map (docks/piers extending onto water tiles).
    - Boats/ships/moored vessels visible at the pier.
  - Overworld integration:
    - Water direction and shoreline for the port town should be derived from the actual overworld water tiles next to the town’s location.
    - Pier orientation (north/south/east/west) should match the adjacent water direction in the overworld.
  - Future extensions (optional):
    - Harbor-specific NPCs (dockworkers, sailors, fishers).
    - Trade modifiers or special caravan/ship visits at ports.
- [ ] Mouse-hover enemy inspect system tied to Perception skill
  - When hovering over a visible enemy tile (dungeon/encounter), show an inspect tooltip describing its relative threat and gear.
  - Low Perception → vague text (“looks weak / dangerous”, “lightly/heavily armored”).
  - Higher Perception → approximate or exact level and stats (Attack/Defense), gear quality (tier), and whether it looks well equipped.
  - Implemented via a lightweight mousemove → tile → enemy lookup and a small DOM tooltip/HUD overlay, with no impact when modals are open or tiles are unseen.
- [ ] Player skill tree and skill points
  - Perception skill that affects how far the player sees other creatures/enemies, and how early encounters/animals are sensed.
  - “Campman” / survival skill affecting animal sensing and how often the player can safely flee from encounters.
- [ ] Passive combat skills
  - One-handed, two-handed, shield use, and striking skills that grow with use up to a cap and affect combat stats.
- [ ] Deeper character sheet and lasting injuries
  - Expand the character sheet to show more flavorful and precise body-state details:
    - Exactly which fingers/toes/limbs are missing, scars, burns, and other lasting marks.
    - Summaries of major injuries vs cosmetic scars.
  - Make some injuries mechanically meaningful:
    - Missing fingers reduce effectiveness with certain weapon types (e.g., bows, heavy two-handed weapons).
    - Leg/foot injuries affect movement speed or dodge chance.
    - Eye injuries affect accuracy or FOV range.
  - Integrate with healing systems:
    - Normal rest/potions handle temporary HP/status.
    - Permanent injuries require special treatment (see healer below).
- [ ] Healer / surgeon NPC for permanent injuries
  - Add a dedicated healer (e.g., in towns or temples) who can treat permanent injuries for gold.
  - Healing options:
    - Remove or mitigate permanent penalties caused by missing digits/limbs/eyes, deep scars, etc.
    - Possibly leave cosmetic marks while removing mechanical penalties.
  - Balancing:
    - Cost scales with severity and number of injuries.
    - May require rare components or reputational thresholds for the most serious fixes.
  - UI:
    - Clear menu explaining what each treatment does, its cost, and what remains (cosmetic vs mechanical).

- [ ] Friendly followers / party system (EXPERIMENTAL, first-pass implemented)
  - Allow the player to have friendly characters that follow them (party members/henchmen).
  - Followers can fight alongside the player and can die permanently.
  - Acquisition paths (not implemented yet):
    - Hire/buy allies from inns or taverns (gold sink, limited slots, different archetypes).
    - Rescue potential followers from special encounters or dungeons (e.g., captives who choose to join).
  - First pass (implemented in v1.61.0 and later tweaks):
    - Data-driven follower archetypes in JSON (`data/entities/followers.json`) loaded via `GameData.followers`.
    - One basic “Guard Ally” follower record on the player, normalized and persisted on the save.
    - Simple spawn/runtime layer:
      - In dungeons/towers/encounters/region-map fights, spawns a guard-style ally enemy near the player that never targets the player but fights hostile factions.
      - In towns/castles, spawns a follower NPC near the gate that follows the player around using town pathing rules.
      - Follower HP/level is synced back into `player.followers` on dungeon/encounter/region exits; town hooks are wired for future extensions.
    - Persistence and saving:
      - Dungeon/town/region state snapshots exclude follower actors/NPCs so followers are always derived from `player.followers` on entry.
      - When a follower dies in combat, their corresponding record is removed from `player.followers` and they will not respawn anywhere (permanent death).
    - Visuals:
      - Follower glyph/color are defined only in `followers.json` and rendered consistently in town, dungeon, and region views with a distinct backdrop.
  - Next steps:
    - Unique follower identity:
      - Followers should receive a unique name drawn from a randomized name pool per archetype (e.g., “Arne the Guard”, “Tuula the Ranger”) when they join.
      - Names are persisted in `player.followers` so the same named follower is seen across dungeons/towns until permanent death.
    - Follower inspect / stats panel:
      - Bumping into a follower in town or dungeon should offer a “Follower” / “Inspect follower” button.
      - Opens a small panel that shows:
        - Follower name, level, HP/max HP, base attack/defense, and faction/role.
        - The same style of equipment slots as the player (left hand, right hand, head, torso, legs, hands).
    - Shared equipment management:
      - From the follower panel, allow equipping/unequipping items for the follower using items from the player’s inventory:
        - Equip/unequip follower left-hand/right-hand and armor slots.
        - When the player unequips an item from the follower, that item is moved into the follower’s personal inventory.
        - When equipping a new item on the follower from the player’s inventory, the replaced item moves into the follower’s inventory.
    - Follower inventory:
      - Each follower has a unique inventory separate from the player’s:
        - Displayed in the follower panel similarly to the player’s inventory list.
        - Items can be transferred:
          - Player → follower: “Give” or “Equip” to send items to the follower (equipped items go into slots, others into follower inventory).
          - Follower → player: “Take” to move items from follower inventory back into the player’s inventory.
      - Items taken from followers should behave exactly like any other item in player inventory (can be equipped, sold, etc.).
    - Follower potion use:
      - Followers can drink their own potions when their HP is low, if they have potions in their personal inventory:
        - Define a low-HP threshold (e.g., ≤ 30% maxHp or a fixed HP value) per follower or archetype.
        - On their turn, if below threshold and a potion is available, the follower consumes a potion instead of attacking, restoring HP and consuming one potion item.
    - Follower death drops:
      - When a follower dies, all of their equipped items and inventory items should be dropped as loot on the ground (added to the corpse/loot at their death location) so the player can recover their gear.
    - Simple follower AI improvements:
      - Trail the player without blocking doors/entrances when possible.
      - Continue to prioritize nearby hostiles using LOS-based targeting.
      - Later: basic morale/retreat logic (e.g., avoid charging into hopeless fights when low on HP and out of potions).
    - Party size & balance:
      - Introduce a configurable party size limit (e.g., 1–3 followers).
      - Ensure follower gear and potion usage are balanced so followers support the player without trivializing combat.

- [ ] GOD Arena mode for combat/AI testing
  - Add a GOD panel entry that teleports the player to a special “arena” test map:
    - A fairly large, open map (big enough to host any prefab layout from towers/towns and generic dungeon rooms).
    - Simple, mostly empty base (flat floor) with optional walls/props the user can place or stamp via prefabs.
    - Uses a dedicated HUD layout with tools for spawning enemies/props/creatures/NPCs and tweaking parameters.
  - Enemy/creature/NPC spawning:
    - List all enemy, creature, and town NPC archetypes used in the game (from data/entities/enemies.json, wildlife/creature registries, and town NPC definitions) in a scrollable/filtered list.
    - Allow spawning one or many instances of the selected type at/around a cursor or the player.
    - Allow batch spawns (“spawn 10 of this type at random positions”).
  - Prefab spawning:
    - Allow stamping any prefab used in towers or towns (JSON room/layouts) into the arena at a chosen anchor:
      - Tower room prefabs (barracks, storage, prison cells, boss arenas, etc.).
      - Town building/interior prefabs, plaza/town props groups, and other reusable layouts.
    - Ensure arena bounds are large enough to accommodate full prefab footprints without clipping.
  - Tweaks and controls:
    - Sliders/inputs for:
      - Enemy level, HP multiplier, damage multiplier, and optional randomization ranges.
      - Global enemy aggression (e.g., shorter/longer detection ranges).
    - Toggles:
      - Player invincible on/off.
      - Enemies see player on/off (stealth/visibility toggle).
      - Freeze/unfreeze enemy AI (debug single-step behavior).
  - Props and walls:
    - Allow placing/removing walls and basic props (crates, barrels, campfires, doors) to simulate different tactical situations.
    - Optionally place simple line-of-sight obstacles to test FOV/cover behavior.
  - Behavior requirements:
    - Enemies in arena mode should behave exactly as in real game contexts (same AI, FOV, pathing, abilities).
    - Arena should not alter core AI logic; it only provides a sandbox and parameter overrides.
  - Safety / exit:
    - Provide a clear “Return from Arena” button that restores the player to their previous mode/position.
    - Ensure arena mode does not affect normal save data (or is clearly tagged as non-persistent) except for intentional tests.

## Technical / Cleanup

- [ ] Mountain-pass dungeons: design and implement a complete rework of A/B linked mountain-pass dungeon behavior (portal logic, overworld exit targets, and persistence); current implementation is experimental and unreliable.
- [ ] GOD panel: add a toggle to visualize enemy FOV/vision cones
  - GOD toggle that overlays the current FOV/vision radius of selected enemies (or all enemies) on the map:
    - Show which tiles each enemy can currently see, based on the same LOS/FOV rules used in real gameplay.
    - Optionally highlight the player when they are inside or outside an enemy’s detection range.
  - Useful for debugging “enemies see through walls”, stealth behavior, and AI targeting without changing core logic.
- [ ] Some files are really big; consider splitting into smaller modules when it makes sense (following existing patterns).
- [ ] Smoketest runner:
  - Remove positional “nudge” for dungeon entry, town entry, dungeon exit, and town exit.
  - Make smoketest positions exact in tiles; only use nudge around NPC interaction or enemy interaction.